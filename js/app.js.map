{"version":3,"file":"build/js/app.js","sources":["app/js/d3.js","app/js/loadmap.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A,CCxEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A","sourcesContent":["window.onload = function() {\n\n    $('.square').hide();\n    $('#council').find('.square').show();\n    $(window).resize(function() {\n        loadmap('council'); //to do BUG\n        sizebuttons();\n    });\n    $(\".label\").on(\"click\", function() {\n        loadmap(this.id);\n    });\n\n    $('.label').click(function() {\n        $('.square').hide();\n        $(this).find('.square').show();\n        //$('.square').show();\n    });\n\n    $('li').click(function() {\n        $('li.selected').removeClass('selected');\n        $(this).addClass('selected');\n    });\n\n    $('div.button').click(function() {\n        $('.square').hide();\n        $('.selected').removeClass('selected');\n        $(this).addClass('selected');\n        var id = '#' + this.id.split(\"-\")[0];\n        $(id).addClass('selected');\n        $(id).find('.square').show();\n        loadmap(id.replace(\"#\", \"\"));\n    });\n\n    $('li').click(function() {\n        $('.selected').removeClass('selected');\n        $(this).addClass('selected');\n        var id = \"#\" + $(\":first-child\", $(this))[0].id + \"-button\";\n        $(id).addClass(\"selected\");\n    });\n\n    /*$(\"#map\").slimScroll({\n        height: '250px'\n    });*/\n    readtotals();\n    readprecincts();\n    loadmap('council');\n\n\n    sizebuttons();\n    getLastUpdate();\n};\n\n$(document).ready(function() {\n    mouseactive = true;\n    $(document).ready(function() {\n        setInterval(function() {\n            var selected = $('.selected')[0].id.split(\"-\")[0];\n            loadmap(selected);\n            getLastUpdate();\n        }, 120000);\n    });\n    var timer;\n    var timeout = function() {\n        $('rect').hide();\n        //alert('No movement!');\n    };\n    timer = setTimeout(timeout, 500);\n    window.onmousemove = function() {\n        $('rect').show();\n        clearTimeout(timer);\n        timer = setTimeout(timeout, 500);\n    };\n});","function addCommas(nStr) {\n    nStr += '';\n    x = nStr.split('.');\n    x1 = x[0];\n    x2 = x.length > 1 ? '.' + x[1] : '';\n    var rgx = /(\\d+)(\\d{3})/;\n    while (rgx.test(x1)) {\n        x1 = x1.replace(rgx, '$1' + ',' + '$2');\n    }\n    return x1 + x2;\n}\n\nfunction sizebuttons() {\n    var width = $(window).width();\n    if ((width) < 400) {\n        $('.button_title').css(\"font-size\", \"1em\");\n        $('.button_title').css(\"font-weight\", \"normal\");\n        $('.button').css(\"margin-left\", \"1.5%\");\n        $('.button').css(\"margin-right\", \"1.5%\");\n        $('.button').css(\"font-size\", \".75em\");\n        $('.button').css(\"width\", \"13%\");\n        $('#buttons').css(\"height\", \"45%\");\n    } else if ((width) < 650) {\n        $('.button_title').css(\"font-size\", \".01em\");\n        $('.button_title').css(\"font-weight\", \"normal\");\n        $('.button').css(\"margin-left\", \"0px\");\n        $('.button').css(\"margin-right\", \"0px\");\n        $('.button').css(\"font-size\", \".75em\");\n        $('.button').css(\"width\", \"17%\");\n        $('#buttons').css(\"height\", \"30%\");\n    } else {\n        $('.button_title').css(\"font-size\", \".01em\");\n        $('.button_title').css(\"font-weight\", \"normal\");\n        $('.button').css(\"margin-left\", \"0px\");\n        $('.button').css(\"margin-right\", \"0px\");\n        $('.button').css(\"font-size\", \".75em\");\n        $('.button').css(\"width\", \"17%\");\n        $('#buttons').css(\"height\", \"20%\");\n    }\n}\n\nfunction sizeResultsBox() {\n\n    var width = $(window).width(),\n        height = $(window).height();\n}\n\n\nfunction getLastUpdate() {\n    var now = new Date();\n    //now = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();\n    $(\"#lastupdate\").html(\"Last update: \" +\n        now.toLocaleTimeString() + \" | page automatically refreshes every 2 minutes.\");\n}\n\nfunction formatTimeOfDay(millisSinceEpoch) {\n    var secondsSinceEpoch = (millisSinceEpoch / 1000) | 0;\n    var secondsInDay = ((secondsSinceEpoch % 86400) + 86400) % 86400;\n    var seconds = secondsInDay % 60;\n    var minutes = ((secondsInDay / 60) | 0) % 60;\n    var hours = (secondsInDay / 3600) | 0;\n    return hours + (minutes < 10 ? \":0\" : \":\") + minutes + (seconds < 10 ? \":0\" : \":\") + seconds;\n}\n\nfunction reloadselected() {\n    try {\n        var selected = $('.selected')[0].id.split(\"-\")[0];\n        loadmap(selected);\n        var now = new Date();\n        now = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();\n        $(\"#lastupdate\").html(now);\n    } catch (err) {}\n}\n\nfunction countprecincts() {\n    var t = $(\".T\").length;\n    var o = $(\".O\").length;\n    return (t + o);\n}\n\nfunction countvotes(candidate) {\n    var t = 0;\n    $(\".\" + candidate).each(function(i, val) {\n        t += parseInt($(this).attr(\"title\").split(\"-\")[0]);\n    });\n    return (t);\n}\n\n\nfunction readprecincts() {\n\n    var totals = {};\n\n    queue()\n        .defer(d3.csv, \"data/precincts.csv\", function(d) {\n            totals[d.district] = d.total;\n        }).await(ready);\n\n    function ready(error, us) {\n        var total_c = totals['50209'];\n        var total_city = totals['50211'];\n        $('#pctreporting-citywide').html(total_c + ' of 65 precincts reporting');\n        $('.pctreporting').html(total_city + ' of 366 precincts reporting');\n    }\n}\n\nfunction readtotals() {\n\n    var totals = {};\n\n    queue()\n        .defer(d3.csv, \"data/master.csv\", function(d) {\n            totals[d.id] = d.votes;\n        }).await(ready);\n\n    function ready(error, us) {\n        for (var prop in totals) {\n            var votes = totals[prop];\n            var selector = \"#\" + prop;\n            $(selector).html(addCommas(votes));\n        }\n    }\n}\n\nfunction loadmap(file) {\n    var votesone = d3.map();\n    var votestwo = d3.map();\n    var visible = \"auto\";\n\n    $(\"#map\").html('');\n\n\n    //Width and height\n    var width = $(\"#mapwrapper\").width(),\n        height = $(\"#mapwrapper\").height();\n\n    var wards = d3.map();\n\n    var svg = d3.select(\"#map\").append(\"svg\")\n        .attr(\"width\", width)\n        .attr(\"height\", height)\n        .attr(\"pointer-events\", visible);\n\n    var projection = d3.geo.mercator().translate([width / 2, height / 2]).scale(((width / 2) + (height / 2)) * 100).center([-89.97, 29.8]);\n\n    var path = d3.geo.path().projection(projection);\n\n    queue()\n        .defer(d3.json, \"maps/w.json\")\n        .defer(d3.csv, \"data/\" + file + \".csv\", function(d) {\n            wards.set(d.id, d.winner);\n            votesone.set(d.id, d.votesone);\n            votestwo.set(d.id, d.votestwo);\n        }).await(ready);\n\n    function ready(error, us) {\n\n        var zoom = d3.behavior.zoom()\n            .translate([0, 0])\n            .scale(1)\n            .scaleExtent([1, 8])\n            .on(\"zoom\", zoomed);\n\n        var features = svg.append(\"g\").attr(\"pointer-events\", visible);\n\n        features.append(\"g\")\n            .attr(\"class\", \"precincts\")\n            .attr(\"pointer-events\", visible)\n            .selectAll(\"path\")\n            .data(topojson.feature(us, us.objects.orleansgeojson).features)\n            .enter().append(\"path\")\n            .attr(\"class\", (function(d) {\n                return wards.get(d.id) + \" precinct\";\n            }))\n        //  .attr(\"title\", (function(d) {\n        //      return votesone.get(d.id) + \"-\" + votestwo.get(d.id);\n        //  }))\n        .attr(\"id\", function(d) {\n            return d.id;\n        })\n            .attr(\"d\", path)\n            .attr(\"title\", function(d) {\n                return votesone.get(d.id) + \"-\" + votestwo.get(d.id);\n            });\n        /*            .append(\"title\")\n            .text(function(d) {\n                return votesone.get(d.id) + \"-\" + votestwo.get(d.id);\n            }); */\n\n        features.append(\"g\")\n            .attr(\"class\", \"coastlines\")\n            .attr(\"pointer-events\", visible)\n            .selectAll(\"path\")\n            .data(topojson.feature(us, us.objects.coastlines).features)\n            .enter().append(\"path\")\n            .attr(\"pointer-events\", visible)\n            .attr(\"d\", path)\n            .attr(\"pointer-events\", visible);\n\n        svg.append(\"rect\")\n            .attr(\"class\", \"overlay\")\n            .attr(\"pointer-events\", visible)\n            .attr(\"width\", width)\n            .attr(\"height\", height)\n            .call(zoom);\n\n        function zoomed() {\n            features.attr(\"transform\", \"translate(\" + d3.event.translate + \")scale(\" + d3.event.scale + \")\");\n            features.select(\".precinct\").style(\"stroke-width\", 1.5 / d3.event.scale + \"px\");\n        }\n\n\n\n        $('path').tipsy({\n            gravity: 'w',\n            html: true,\n            title: function() {\n                var ward = \"Ward: \" + this.id.split(\"-\")[0] + \"\\n\";\n                var precinct = \"Precinct: \" + this.id.split(\"-\")[1] + \"\\n\";\n                var v1 = votesone.get(this.id);\n                var v2 = votestwo.get(this.id);\n                var c1 = $(\".selected\").find(\".votesone\").html() + \": \";\n                var c2 = $(\".selected\").find(\".votestwo\").html() + \": \";\n                return ward + \"<br>\" + precinct + \"<br>\" + c1 + v1 + \"<br>\" + c2 + v2;\n            }\n        });\n        $('rect').hide();\n\n    }\n\n}"]}